#! /bin/sh
# Opens vim in a new PlantUML file in ~/Documents/notes prefixed with current date
# (or optionally an alternate date).
#
# Usage:
# umlnote [-v ARG | --days-ago NUM | --yesterday] [NOTE_LABEL]
#
# Examples:
# % umlnote
#     Opens note for today with label "note"
#
# % umlnote dailynotes
#     Opens note for today with label "dailynotes"
#
# % umlnote --days-ago 7 dailynotes
#     Opens note for 7 days ago with label "dailynotes"
#
# % umlnote --yesterday ideas
#     Opens note for yesterday with label "ideas"
#
# % umlnote +1y futuristic
#     Opens note dated one year from today with label "futuristic"
#
set -e

while true; do
  case "$1" in
    -v ) DATE_V_ARG="$2"; shift 2 ;;
    --days-ago ) DATE_V_ARG="-$2d"; shift 2 ;;
    --yesterday ) DATE_V_ARG="-1d"; shift ;;
    * ) LABEL="$1"; break ;;
  esac
done

DATE_EXPR="/bin/date -v $DATE_V_ARG +%Y-%m-%d"
if [ -z "$DATE_V_ARG" ]; then
  DATE_EXPR="/bin/date +%Y-%m-%d"
fi
DATE=$($DATE_EXPR)

LABEL="$1"
if [ -z "$LABEL" ]; then
  LABEL="note"
fi
FILENAME="${DATE}_${LABEL}.uml"
NOTESDIR=~/Documents/notes
mkdir -p $NOTESDIR

echo "Opening ${NOTESDIR}/${FILENAME}"
cd "${NOTESDIR}"
printf "@startuml\\n\\n@enduml\\n\\n" > "${FILENAME}"
$EDITOR "${FILENAME}"

